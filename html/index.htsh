<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Mealie but faster</title>
<style>
div.gallery {
  margin: 5px;
  border: 1px solid #ccc;
  float: left;
  width: 200px;
  height: 290px;
}

div.gallery:hover {
  border: 1px solid #777;
}

div.gallery img {
  width: 100%;
  height: 69%;
  object-fit: contain;
  background: #f1f1f1;
}

div.desc {
  padding: 15px;
  text-align: center;
  height: 60px;
}
</style>
</head>
<body>
<h1>My Recipes</h1>
<?bash

echo '<div>'
echo aa $HTTP_HOST bb
address=$(echo $HTTP_HOST | sed -e 's/:[0-9]*//')
if [[ $address =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
  echo "local"
  mealie_url=$mealie_local
else
  echo "external"
  mealie_url=$mealie_public
fi
echo '</div>'

cd /var/www/html
req=$(curl $mealie_api'/api/recipes?keys=slug&num=9999' \
    -H 'Accept: application/json, text/plain, */*')
imgs=$(echo $req | \
	sed -e 's/"slug":"\([a-z0-9\.\-]*\)/\1\\n/g' |
    sed -e 's/.*,\([a-z0-9\.\-]*\)/\1\\n/g' |
    sed -e 's/\}\]//g' |
	sed -e 's/"//g')
	
for img in $imgs; do
    if [ ! -f "img/$img" ]; then
		curl $mealie_api'/api/recipes/'"$img"'/image?image_type=small' > img/$img
	fi
	st=$(echo $img | sed -e 's/\(.*\)\.[^.]*/\1/g')
	title=$(echo $st | sed -e 's/\-/ /g')
	
	echo '<div class="gallery">'
    echo '<a target="_blank" href="'$mealie_url/recipe/$st'">'
    echo '<img src="img/'$img'" alt="$img">'
    echo '</a>'
    echo '<div class="desc">'$title'</div>'
    echo '</div>'
done
?>
</body>
</html>
